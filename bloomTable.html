<!DOCTYPE html>
<html>

<head>
    <style>
        .bloomTable {
            border-collapse: collapse;
            border-spacing: 0;
            width: 100%;
        }
        
        th,
        td {
            border: none;
            text-align: left;
            padding: 8px;
        }

        .plants_div {
            display: none;
        }
    </style>
</head>

<body>
    <center>
        <h2>Bloom Table</h2></center>


    <p>
        <center>
            <input id="plantsButton" class="btn" type="button" value="Plants" />
        </center>
    </p>

    <p>
        <div id="plants" class='plants_div'>
        </div>
    </p>

    <center>
        <div style="overflow-x:auto;">
            <table class="bloomTable" id="bloomTable" rules="rows">
                <thead>
                    <tr id="header">
                        <th></th>
                        <th>April</th>
                        <th>May</th>
                        <th>June</th>
                        <th>July</th>
                        <th>August</th>
                        <th>September</th>
                        <th>October</th>
                    </tr>
                </thead>
                <tbody id="bloomTableBody">
                </tbody>
            </table>
        </div>
    </center>

</body>

<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
<script>
    //Tall
    var newenglandaster = JSON.parse('{"id": "newenglandaster", "name":"New England Aster", "start": 8, "end" : 9, "size" : "tall", "color":"#aa71c2", "bloom" : ["late"]}');

    //Medium
    var purpleconeflower = JSON.parse('{"id": "purpleconeflower", "name":"Purple Coneflower", "start": 6, "end" : 8, "size" : "med", "color":"#ff8ecf", "bloom" : ["mid","late"]}');
    var blazingstar = JSON.parse('{"id":"blazingstar", "name":"Prairie Blazing Star", "start": 7, "end" : 8, "size" : "med", "color":"#ad79b7", "bloom" : ["mid","late"]}');
    var pprairieclover = JSON.parse('{"id":"pprairieclover", "name":"Purple Prairie Clover", "start": 6, "end" : 8, "size" : "med", "color":"#b632a9", "bloom" : ["mid","late"]}');
    var bluestar = JSON.parse('{"id":"bluestar", "latin":"Amsonia ciliata", "name":"Blue Star", "start": 5, "end" : 5, "size" : "med", "color":"#acaed5", "bloom" : ["early"]}');
    var thimbleweed = JSON.parse('{"id":"thimbleweed", "latin":"Amsonia ciliata", "name":"Thimbleweed", "start": 4, "end" : 5, "size" : "med", "color":"white", "bloom" : ["early"]}');

    //Small
    var harebell = JSON.parse('{"id":"harebell", "name":"Harebell", "start": 6, "end" : 9, "size" : "short", "color":"#a4a8ff", "bloom" : ["mid", "late"]}');
    var loveleighest = JSON.parse('{"id":"loveleighest", "name":"MostLoveLeigh", "start": 6, "end" : 7, "size" : "short", "color":"#a4a8ff", "bloom" : ["mid"]}');

    $(document).ready(function () {

        initPlantsButton();
        buildTable();
        addSelectAll();




        function buildTable() {
            var tallPlants = new Array(newenglandaster);
            var mediumPlants = new Array(purpleconeflower, blazingstar, pprairieclover, bluestar, thimbleweed);
            var smallPlants = new Array(harebell, loveleighest);

            addToTable(tallPlants);
            addToTable(mediumPlants);
            addToTable(smallPlants);
        }



        function addToTable(plantArray) {
            var $table = $('#bloomTableBody');
            plantArray.forEach(function (plant) {

                addCheckbox(plant);

                var $row = $('<tr>')
                    .attr('id', plant.id + '_row')
                    .attr("plantsize", plant.size)
                    .attr("bloom", plant.bloom)
                    .attr("plantid", plant.id)
                    .attr('filters', plant.size + ',' + plant.bloom)
                    .css("display", "none")
                    .appendTo($table);

                $row.addClass("plantRow");
                $row.click(function () {
                    $('#' + plant.id + '_checkbox').prop('checked', false).change();
                });


                var $td = $('<td>')
                    .text(plant.name)
                    .appendTo($row);


                for (i = 4; i <= 10; i++) {
                    if (i >= plant.start && i <= plant.end) {
                        if (plant.color == 'white') {
                            var $td = $('<td>');
                            $td.css("border-top", "1px solid #4f4f4f");
                            $td.css("border-bottom", "1px solid #4f4f4f");
                            if (i == plant.start) {
                                $td.css("border-left", "1px solid #4f4f4f");
                            } else if (i == plant.end) {
                                $td.css("border-right", "1px solid #4f4f4f");
                            }
                            $td.appendTo($row);
                        } else {
                            $('<td>')
                                .css("background-color", plant.color)
                                .appendTo($row);
                        }
                    } else {
                        $('<td>')
                            .appendTo($row);
                    }
                }
            });
        }

    });



    function addCheckbox(plant) {
        var container = $('#plants');

        var label = $('<label />', {
            id: plant.id + "_label",
            'plantid': plant.id,
            text: plant.name
        });
        label.addClass("plantCheckboxLabel");
        label.attr("plantsize", plant.size)
            .attr('filters', plant.size + ',' + plant.bloom)
            .attr("bloom", plant.bloom);

        var checkbox = $('<input />', {
            type: 'checkbox',
            id: plant.id + "_checkbox",
            'plantid': plant.id,
            value: plant.id
        });

        checkbox.addClass("plantCheckbox");
        checkbox.change(function (e) {
            var row = $('#' + plant.id + "_row");
            if (this.checked) {
                localStorage.setItem("plantselected_" + plant.id, "true");
                row.css("display", "");
            } else {
                localStorage.setItem("plantselected_" + plant.id, "false");
                row.css("display", "none");
                $("#selectAll").prop("checked", false);
            }


        });
        checkbox.prependTo(label);

        label.appendTo(container);
        localStorage.setItem("plantselected_" + plant.id, "false");

        //        $('<br>').appendTo(container);
    }




    function addSelectAll() {
        var container = $('#plants');

        var checkbox = $('<input />', {
            type: 'checkbox',
            id: 'selectAll',
            className: "selectAll",
            value: "selectAll"
        });

        checkbox.change(function (e) {
            $(".plantCheckbox").prop('checked', $(this).prop('checked')).change();
        });

        checkbox.prop("checked", true).change();

        checkbox.appendTo(container);

        $('<label />', {
            'for': 'selectAll',
            text: 'Select All'
        }).appendTo(container);

        $('<br>').appendTo(container);
    }

    function initPlantsButton() {
        $("#plantsButton").click(function () {
            $("#plants").slideToggle("slow");
        });
    }




    Array.prototype.allValuesSame = function () {

        for (var i = 1; i < this.length; i++) {
            if (this[i] !== this[0])
                return false;
        }

        return true;
    }
</script>

</html>
